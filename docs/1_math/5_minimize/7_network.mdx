---
title: ネットワーク最適化
---

## グラフ

:::note[諸々の用語]
- **点**（頂点，ノード）：$V$,  **枝**（辺，エッジ）：$E \subset V \times V$,  **グラフ**：$G = (V, E)$
- **$G$ の部分グラフ**：$G$ のいくつかの点と枝からなるグラフ
- 枝の一つ $e = (v_i,v_j) \in E$ について, $v_i$ を $e$ の**始点**, $v_j$ を $e$ の**終点**といい, $v_i$ と $v_j$ は**隣接**しているという. 
また, 始点と終点をまとめて $e$ の**端点**という.
- **単純グラフ**：自己閉路と多重枝を含まないグラフ（以降は単純グラフのみを考える）
- **次数**：グラフの点に接続する枝の数
- **道**：枝の向きとは無関係に，接続する点と枝をたどることによって得られる点と枝の系列
    - 道の最初の点をその道の始点，最後の点をその道の終点という
    - 道を構成する枝の数を長さという
    - 枝の向きに沿って進むことで得られる道を有向道という
- **(有向)閉路**：始点と終点が一致する(有向)道
:::

:::note[連結性]
#### **連結グラフ**：任意の2点の間に道が存在するグラフ（有向でも無向でも良い）
- **木**：閉路を含まない連結グラフ
- **葉**：接続する枝が１つだけの木の点（次数が1の点）
- **根**：木の特定の点のこと（根を考えている木を根付き木という）
- $G'$ が $G$ の**全域木グラフ**：$G = (V, E)$ の部分グラフ $G' = (V, E')$ が木である

以下は定理など
- $G$ に全域木グラフが存在する $\Leftrightarrow$ $G$ が連結である
- 2点以上から成る木は葉が2つ以上ある
- 連結グラフ $T$ について以下は同値
    - $T$ は木
    - 任意の2点間に一意に道が存在する
    - 任意の枝を取り除くと非連結になる
- 木は１つ枝を取り除くと，２つの木になる
- 木から葉（次数1の点）とその点に接続する枝を取り除いたグラフも木である
- $n$ 点の木は $n-1$ 本の枝をもつ
:::

## 様々なアルゴリズム
詳しくはアルゴリズムの記事参照
- クラスカル法：辺ベースで最小全域木を求めるアルゴリズム
- プリム法：点ベースで最小全域木を求めるアルゴリズム
- グラフ探索：グラフの各点と各枝を探索する手法
    - 深さ優先探索（Depth-first search: DFS）：とりあえず⾏けるところまで⾏き, ダメなら後戻りするグラフ探索方法
        - 根からすべての点を反時計回りするように一筆書き（帰りがけ順）
    - 幅優先探索（Breadth-first search: BFS）：後戻りしないように, 可能性のあるルート全てにおいて1ステップずつ⾏くグラフ探索方法

## 有向グラフの接続行列
:::tip[接続行列]
$G$: 有向グラフ（点が $n$ 個で枝が $m$ 本）. $n \geq 2$ とする枝には一意な番号 $e \in \{1, 2, \ldots, m\}$ が付いている

接続行列 (incidence matrix)：$
B(G) = (b_{ie}) \in \mathbb{Z}^{n \times m} \Leftrightarrow
b_{ie} =
\begin{cases}
1 & \text{点 } i \text{ から枝 } e \text{ が出る} \\
-1 & \text{点 } i \text{ に枝 } e \text{ が入る} \\
0 & \text{点 } i \text{ と枝 } e \text{ が接続していない}
\end{cases}
$
:::
:::tip[定理]
$B \in \mathbb{R}^{n \times (n-1)}$: $n$ 点の連結グラフのある全域木に対応する接続行列

$B$ は行と列を入れ替えることで
$
\begin{pmatrix}
\pm 1 & … & 0 \\
\ast & … & … \\
\ast & \ast & \pm 1 \\
\ast & \ast & \ast \\
\end{pmatrix}
= PBQ
\Rightarrow \text{rank } B = n - 1
$  
という形にできる
:::

### 最小費用流問題
:::warning[目標]
連結グラフ $G = (V, E)$ 

minimize $\sum_{(i,j) \in E} c_{ij} x_{ij}~\\$ 
subject to $~\sum_{(k,i)\in \delta^+ (k)} x_{ki} - \sum_{(j,k)\in \delta^- (k)} x_{jk} = b_k,~k \in V,~x_{ij} \ge 0,~(i,j) \in E$
- $c_{ij}$：枝 $(i,j)$ の費用, $x_{ij}$：枝 $(i,j)$ のフロー
- 仮定：点 $k$ はフロー $b_k$ を生成する（各点の供給量 - 需要量）, $\sum b_k = 0$（各点の総需要量 = 総供給量）
- $\delta^+ (k)$：点 $k \in V$ から出る枝の集合, $\delta^- (k)$：点 $k \in V$ に入る枝の集合
:::
要するに, 点ごとのフローのバランスを保ちながら, 最小費用でフローを流す問題
- 各点での需要と供給の差が $b_k$ である

命題：
$G$ ：連結グラフ, $A \in \mathbb{R}^{n \times m}$：$G$ に対応する接続行列 
$\Rightarrow \exists P $：置換行列 $ \ \text{s.t.} \ \text{rank}\left(PA \ \middle| \ e_n\right) = n$
- これは, 接続行列をうまいこと入れ替えればできるよというだけ
（$P$ は, $G$ のある全域木 $T$ に深さ優先探索（帰りがけ順）で点に順番をつけて, その順番に $A$ の行が並ぶようにする置換行列）
- $e_n$ は根に人工枝をつけることに相当する

その結果として, 最小費用流問題は次のような線形計画問題に帰着できる
:::warning[目標]
minimize $c^T x~$ subject to $~ Ax = b~(x \ge 0)~~$
$($ただし, $A \in \mathbb{R}^{n \times m},~b \in \mathbb{R}^n,~c \in \mathbb{R}^m)$
- $n$：点の数, $m$：辺の数
- $A$：連結グラフに対応する接続行列, $b$：各点のフローのバランス $(\sum b_k = 0)$, $c$：各辺の費用
- 連結なので, $\text{rank}(A) = n-1$

これは, 単体法などで解くことができる
:::