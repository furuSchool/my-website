---
title: 5. 検定
---

ここでは，数学的な厳密性はやや脇に置いた説明を行う。より厳密なものはいつかできれば。

## 統計的決定理論
:::tip[統計的決定理論]
統計的推測を，標本 $X = (X_1, X_2, \ldots, X_n)$ に基づいて行う。$X$ の実現値全体の集合を **標本空間** $\mathcal{X}$ とする。

統計的推測においては， $X$ の属する分布族 ( = **統計的モデル**) を仮定する。
この時，分布族の変数を **パラメータ，母数** $\theta$ とし，$\theta$ の取りうる値の集合を **母数空間，パラメータ空間** $\Theta$ と呼ぶ。
- 例えば，分布族を正規分布 $N(\mu, \sigma^2)$ とすると，$\theta = (\mu, \sigma^2)$ である
:::
- 標本空間はどの確率変数に注目するかで変わる
- パラメータは基本的に未知である

---
## 検定の仕組み
:::tip[検定の仕組み]
- 帰無仮説 $H_0$ : 実パラメータ $\theta$ が $\Theta_0$ に属しているとする仮説
    - 対立仮説 $H_1$ : 実パラメータ $\theta$ が $\Theta_0$ に属していないとする仮説(母数空間 = $\Theta_0 \cup \Theta_1$，$\Theta_0 \cap \Theta_1 = \emptyset$)
- 両側検定 : $H_0 : \theta = \theta_0$ に対して $H_1 : \theta \neq \theta_0$，
片側検定 : $H_0 : \theta \leq \theta_0$ に対して $H_1 : \theta > \theta_0$ など
- $H_0$ が正しいと判断する時，**帰無仮説を受容する**，$H_1$ が正しいと判断する時，**帰無仮説を棄却する** と呼ぶ
:::
検定を行う例
1. データによって $H_0$ を棄却する目的で使う : 例）$H_0$ : ある薬の効果がないとして，実験結果との矛盾を示す
2. 通常成り立つことを $H_0$ とする : 例）$H_0$ : 不良率が $p$ 以下であるとして，それを超えるかどうかを調べる
3. 適合度検定 : 例）$H_0$ : データがある分布に従うとして，正しいかどうかを調べる

その他
- 局外母数，撹乱母数 : 未知ではあるが興味はない母数
    - 例: $\Theta_0 = \{(0, \sigma^2) | \sigma^2 > 0\}$ の場合，$\sigma^2$ は局外母数

### 第 1 種の過誤，第 2 種の過誤
|                        | **$H_0$ を受容**         | **$H_0$ を棄却**         |
|------------------------|--------------------------|--------------------------|
| **$\Theta_0$ ($H_0$ が正しい)** | 正しい判断               | 第 1 種の過誤，偽陽性，FN (確率 $\alpha$)|
| **$\Theta_1$ ($H_0$ が誤り)**   | 第 2 種の過誤，偽陰性，FP (確率 $\beta$) | 正しい判断               |

- **第 1 種の過誤**: 帰無仮説 $H_0$ が正しいのに棄却してしまう誤り (損失 $\alpha$)
- **第 2 種の過誤**: 帰無仮説 $H_0$ が誤りなのに受容してしまう誤り (損失 $\beta$)
- **検出力**: $1 - \beta$ で，帰無仮説 $H_0$ が誤りの時に棄却できる確率。真の母数との距離が大きいほど検出力は高くなる
<img src="/img/math/statistical-power.png" style={{ width: '60%' }} alt="検出力" />

:::note[有意水準]
伝統的な検定では，第 1 種の過誤の確率をある限界 $\alpha$ 以下に抑えるようにする。この時，この $\alpha$ を **有意水準** と呼ぶ。
- 有意水準を小さくすれば第 1 種の過誤は小さくなるが，第 2 種の過誤は大きくなる
:::

また，検定では，標本空間を分割して，帰無仮説を受容する領域と棄却する領域を決める。その際，特定の統計量 $T(X)$ の値を用いることが多い。
そのため，帰無仮説の受容域 $\{x | T(X) \leq c\}$，棄却域 $\{x | T(X) > c\}$ のようになるが，$c$ を **棄却点** と呼ぶ。

:::note[p 値]
**p 値** : $H_0$ が正しいと仮定した時，観測された統計量 $T(X)$ よりも極端な値が得られる確率。
- $p = \sup_{\theta \in \Theta_0} P(T(X) \geq c, \theta)$

このようにすれば，$p \leq \alpha$ の時，帰無仮説を棄却することができる。
:::

---
## 典型的な検定
### 正規分布の推定
$X_1, X_2, \cdots, X_n \sim N(\mu, \sigma^2)~i.i.d.$ とする
:::tip[正規分布の 1 標本の場合]
1. $\sigma$ が既知の場合の $\mu$ の検定 ( $z$ 検定)
    - 区間推定 : $\mu \in \left( \bar{X} - z_{\alpha/2} \frac{\sigma}{\sqrt{n}}, \bar{X} + z_{\alpha/2} \frac{\sigma}{\sqrt{n}} \right)$
    - 検定 : $H_0 : \mu = \mu_0$ に対して，$H_1 : \mu \neq \mu_0$ の検定を行う (両側検定の場合)
        - $p$ 値 : $p = 2 P(Z > |\frac{\sqrt{n}(\bar{X} - \mu_0)}{\sigma}|)$
2. $\sigma$ が未知の場合の $\mu$ の検定 ( $t$ 検定)
    - 不偏分散 $s^2 = \frac{1}{n-1} \sum_{i=1}^n (X_i - \bar{X})^2$ を用いる
    - 区間推定 : $\mu \in \left( \bar{X} - t_{\alpha/2, n-1} \frac{s}{\sqrt{n}}, \bar{X} + t_{\alpha/2, n-1} \frac{s}{\sqrt{n}} \right)$
    - 検定 : $H_0 : \mu = \mu_0$ に対して，$H_1 : \mu \neq \mu_0$ の検定を行う (両側検定の場合)
        - $p$ 値 : $p = 2 P(T > |\frac{\sqrt{n}(\bar{X} - \mu_0)}{s}|)$
3. $\mu$ が既知の場合の $\sigma$ の検定 (あまりない)
    - 区間推定 : $\sigma^2 \in \left( \frac{\sum_{i=1}^n (X_i - \mu)^2}{\chi^2_{n, \alpha/2}}, \frac{\sum_{i=1}^n (X_i - \mu)^2}{\chi^2_{n, 1 - \alpha/2}} \right)$
    - 検定 : $H_0 : \sigma^2 = \sigma_0^2$ に対して，$H_1 : \sigma^2 \neq \sigma_0^2$ の検定を行う (両側検定の場合)
        - $p$ 値 : $p = 2 P(\chi^2_{n} > \frac{\sum_{i=1}^n (X_i - \mu)^2}{\sigma_0^2})$
4. $\mu$ が未知の場合の $\sigma$ の検定
    - 区間推定 : $\sigma^2 \in \left( \frac{\sum_{i=1}^n (X_i - \bar{X})^2}{\chi^2_{n-1, \alpha/2}}, \frac{\sum_{i=1}^n (X_i - \bar{X})^2}{\chi^2_{n-1, 1 - \alpha/2}} \right)$
    - 検定 : $H_0 : \sigma^2 = \sigma_0^2$ に対して，$H_1 : \sigma^2 \neq \sigma_0^2$ の検定を行う (両側検定の場合)
        - $p$ 値 : $p = 2 P(\chi^2_{n-1} > \frac{\sum_{i=1}^n (X_i - \bar{X})^2}{\sigma_0^2})$
:::

次に，$X_1, X_2, \cdots, X_m \sim N(\mu_1, \sigma_1^2)~i.i.d.$ と $Y_1, Y_2, \cdots, Y_n \sim N(\mu_2, \sigma_2^2)~i.i.d.$ の 2 標本の場合を考える。
- $X_i$ と $Y_j$ が互いに独立であるとする

:::note[対標本の場合]
対標本の場合，$(X_1, Y_1), (X_2, Y_2), \cdots, (X_n, Y_n)$ のように，$X_i$ と $Y_i$ が対応しているとする。  
この時，$X_i \sim N(\mu_i, \sigma^2),~~ Y_i \sim N(\mu_i + \Delta, \sigma^2)$ と仮定する。  
この場合は，$U_i = Y_i - X_i \sim N(\Delta, \sigma^2)$ となるから，1 標本の場合に帰着できる。
:::

:::tip[正規分布の 2 標本の場合]
1. $\sigma_1, \sigma_2$ が既知の場合の $\mu_1, \mu_2$ の検定
    - 区間推定 : $\mu_2 - \mu_1 \in \left( \bar{Y} - \bar{X} - z_{\alpha/2} \sqrt{\frac{\sigma_1^2}{m} + \frac{\sigma_2^2}{n}}, \bar{Y} - \bar{X} + z_{\alpha/2} \sqrt{\frac{\sigma_1^2}{m} + \frac{\sigma_2^2}{n}} \right)$
2. $\sigma_1, \sigma_2$ が未知の場合の $\mu_1, \mu_2$ の検定
    - 不偏分散 $s_1^2 = \frac{1}{m-1} \sum_{i=1}^m (X_i - \bar{X})^2$，$s_2^2 = \frac{1}{n-1} \sum_{j=1}^n (Y_j - \bar{Y})^2$ を用いる
    - 区間推定 : $\mu_2 - \mu_1 \in \left( \bar{Y} - \bar{X} - t_{\alpha/2}(f) \sqrt{\frac{s_1^2}{m} + \frac{s_2^2}{n}}, \bar{Y} - \bar{X} + t_{\alpha/2}(f) \sqrt{\frac{s_1^2}{m} + \frac{s_2^2}{n}} \right)$
        - $f = \frac{(s_1^2/m + s_2^2/n)^2}{\frac{(s_1^2/m)^2}{m-1} + \frac{(s_2^2/n)^2}{n-1}}$ (ウェルチの方法)
        - ただしこれは近似的なものであり，ウェルチの信頼区間と呼ばれる
    - $\sigma_1 = \sigma_2 = \sigma$ で，$\sigma$ が未知の場合は，  
    区間推定 : $\mu_2 - \mu_1 \in \left( \bar{Y} - \bar{X} - t_{\alpha/2, n+m-2}~s \sqrt{\frac{1}{m} + \frac{1}{n}}, \bar{Y} - \bar{X} + t_{\alpha/2, n+m-2}~s \sqrt{\frac{1}{m} + \frac{1}{n}} \right)$
        - $s^2 = \frac{(m-1)s_1^2 + (n-1)s_2^2}{m+n-2} = \frac{1}{m+n-2} (\sum_{i=1}^m (X_i - \bar{X})^2 + \sum_{j=1}^n (Y_j - \bar{Y})^2)$
