---
title: 2. コンピュータの全体像
---


## 基本的なコンピュータの構成
:::tip[基本的なコンピュータの構成]
- プロセッサ: コンピュータの中心部。メモリの指示内容に従ってメモリを書き換えるユニット (Central Processing Unit) 
    - CPU, GPU, DSP, TPU, NPU, etc
    - 主記憶装置から取り出した命令を一つ読み，データ操作して，次の命令アドレスを決定することを繰り返す ( = プログラム内蔵方式)
- 主記憶装置: プロセッサがアクセスするメモリ
    - メインメモリ，キャッシュメモリ，etc
- 補助記憶装置: メインメモリより大容量の記憶装置
    - ハードディスク，SSD，テープ，etc
- 入出力装置: プロセッサと外部機器を接続する装置
    -  キーボード，マウス，ディスプレイ，ストレージ装置，etc.
    - プログラムデータや結果を記憶装置を通じてやり取りする
:::
<img src="https://www.nt-go.com/img/image31.png" alt="コンピュータの基本構成" style={{ width: '40%' }} />

画像は https://www.nt-go.com/posts/post11.html より引用。ノイマン型コンピューターと呼ばれる。

---
## CPU
### 命令とシーケンサ
:::tip[命令とシーケンサ]
**命令 : コンピュータの動作を指定する情報**  
**シーケンサ : 順次命令を生成する機構**
:::
命令を集めてアルゴリズムやプログラムを実現する。命令の詳細は次回。
- 命令はデータとして (例えば32bit列として) 表現される
- 数個のフィールドからなり，メモリに入れられ，読みだして使われる (= フェッチ) 
- “Instruction Set Architecture” (ISA) : そのコンピュータが受け付ける命令集合の仕様

一方で，シーケンサは次の順次命令を生成する機構。  
- PC (プログラムカウンタ) が現在実行中の命令アドレスを保持するレジスタ。  
NPC (= PC + 4 (大抵) ) を命令メモリに渡すことで，次の命令を取得する

### CPU の基本的な構成
<img src="/img/information/cpu.png" alt="CPU の例" style={{ width: '90%' }} />

画像は [BRISC-V](https://arxiv.org/pdf/1908.09992) より引用

:::tip[CPU の単純な流れ]
- プログラムカウンタ (PC) から命令メモリにアクセスして，命令を取得
- 命令をデコード
- レジスタファイルにアクセスして，データを読み書き
- 必要ならメモリにアクセスして，データを読み書き
- ALU で演算して，結果をレジスタファイルや，必要ならメモリに書き込む
- プログラムカウンタを更新して，次の命令を取得
:::

次章以降でもう少し詳しく説明。

---
## 主記憶装置
メインメモリ，単にメモリ，とも。レジスタより大容量化が容易な回路。一般には **DRAM** が使われる。
- ロード操作
    1. リクエスト: ほしいバイト数などフォーマット指定情報，**メモリアドレス**を主記憶装置に渡す
    2. メモリから読み出された値を (書き込み値選択して) レジスタへ書き込む
- ストア操作
    1. リクエスト: フォーマット指定情報， (ALUによりリクエストに生成された) **書き込み値**，**メモリアドレス**を主記憶装置に渡す
    2. ALUによりリクエストに必要なデータを生成，メモリへ書き込み

### メモリアレイの基本構造
- ビットセルの二次元配列で，各ビット・セルは 1 ビットを保持
- アドレス幅が $N$ ，データ幅 $M$の場合，$2^N$ 行 $M$ 列
    - あるアドレスがアクセスされた時，$2^N$ 行のうち対応する $1$ 行を選択し，その WL(ワード・ライン) をアサートする
    - 列に対応するのは BL(ビット・ライン) と呼ばれる
- エントリ数 : 行数 (ワード数) $2^N$
- ワード・サイズ : 列数 $M$
- アレイ・サイズ :  $2^N\times M$

### メモリの分類
:::note[メモリの分類]
#### ROM (Read Only Memory) : 基本的には不揮発性。ファームウェアの格納など。データを変更しないものに使用する
- マスク ROM : 製造時にデータを焼き付ける ROM
- PROM : ユーザーの手で一度だけ書き込める ROM
    - ヒューズROM : 簡単に焼き切れる
    - EPROM (Erasable PROM)  : 特別な行為 (紫外線等) で書き換えられるもの
        - UVEPROM, EEPROM 
        - **フラッシュメモリ** : 現在の主流。電気的にブロック単位で書き換えられる。SSD に使われるものはほとんどこれ
            - ROM なのか ? という感じだが，不揮発性だから ROM から発展したものとして扱われている

#### RAM (Random Access Memory)  : どのメモリアドレスに対しても、ほぼ一定の時間でアクセスできるメモリ。揮発性 (電源を切ると内容が消える)。
- SRAM (インバータ二つのバイ・ステーブル回路) : レジスタとして使われることが多い (**少し高いが非常に早い**)
    - ダブルエンド: 同相ノイズをキャンセル
        - 読み出し時 : 
            - まず BL と $\overline{\text{BL}}$ の両方を "1" に
            - 次に WL をアサート
            - BL 同士の差動センス・アンプを作動させて値を高速に確定
        - 書き込み時 : 
            - BL に値をセットしてから WL をアサートして書き込み
    - 6 トランジスタくらい
- DRAM (コンデンサ) : 主記憶として使われることが多い (**安いが，少し遅め**)
    - 高速ページモードDRAM
    - SDRAM (Synchronous DRAM) 
    - 「動的(dynamic)」 : キャパシタの自然放電により電荷 (情報) が失われるので
    リフレッシュ (再書き込み) が必要
        - 定期的に読んで書き戻し
        - 通常の読み出しでも値が壊れるので書き戻しが必要
    - 1 トランジスタくらいで大丈夫
    - レイテンシは悪いが，スループットはよくなる工夫がされている
    - VRAM : GPUに搭載される専用RAM。グラフィックス (や機械学習) に特化
        - GPU が扱う大容量データを格納
        - スループットを重視
:::

---
## その他
### FPGA (Field Programmable Gate Array)
メモリとロジックの等価性を元に，任意のディジタル回路の仕様を実現するもの。CPU などのこれまでのものと異なり，ユーザが後から自由に回路を設計できる。
- LE (Logic Element) : ロジックを実現する。LUT + フリップフロップ
    - LUT (Look-Up Table) で組み合わせ回路を実現する。実態は小規模な SRAM であり，格納する値を変えることで論理関数を実現 (入力 → 出力の対応を格納するイメージ)
    - フリップフロップで順序回路を実現する
- IOE (Input Output Element) : 外部との入出力を行う
- Progammable Interconnect : LE と IOE を接続する
- 他に，乗算器やメモリなどのブロックがある

その他
- マイクロプロセッサ : 1つのICに収まっているプロセッサ。今では，一般的にはプロセッサの (複数) 入ったチップ/パッケージを指す