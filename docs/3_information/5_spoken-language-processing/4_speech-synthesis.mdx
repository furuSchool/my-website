---
title: 4. 音声合成
---

:::warning[目標]
文字列を入力として音声波形を出力する方法を学ぶ！
:::

---
## 基本

### 音声合成で注意するべきこと
- 入力文字列からどう音声記号表記を導出するのか：同じ文字でも発音が異なる場合がある
- アクセントやアクセント結合
- 個々の音素の継続調やイントネーションをどうするか

### 音声合成の流れ
:::tip[音声合成の流れ]
1. 言語解析（形態素解析）：読み仮名，品詞などの決定
    - ここは別の記事で詳しく説明する
2. 音韻処理：音素列，音声記号列，アクセント位置などの決定
3. 韻律処理：音素継続長，アクセントや句構造を考慮した $F_0$ パターンの決定
4. 波形生成：イメージはフーリエ逆変換。以下の方法がある
    - **波形編集方式**：複数の波形テンプレート（音素，モーラ，音節などの素片データベースみたいなもの）を用意して，コストが最小になるように切り貼りする方式
    - **HMM 合成**：（スペクトル包絡をモデル化対象として）音素 HMM を接続して文 HMM を構成し，尤度最大となるスペクトル包絡列を構成する
:::

---
## 音韻処理
:::tip[音韻処理]
個々の形態素の結果を元に "読み" を決定する。
:::
以下は日本語の例
- 連濁処理：複合語を作るときに後続語が濁る。まんが**ぼ**ん……
- 数詞，助数詞：1匹，２匹……，「553」（ごひゃくごじゅうさん，ごーごーさん）……
- 同形異音語：生物……
- 記号や略称：CM，cm……
- 音韻変形：ひらがなと音声が対応していない，「を」と「お」，映画（えーが），鼻母音化，無声化……
- アクセント付与：日本語だと，単語アクセントは高さアクセント $\rightarrow$  モーラごとに H/L アクセントを付与する
    - モーラ：日本語において使われる，音素 + 促音・長音。いわゆる，1 音に対応する
    - $F_0$ の急激な下落の直前のモーラ：アクセント核
    - アクセント句：文法的，意味的な数語のまとまり。アクセント核が 1 つつく傾向
- ポーズ付与：適宜ポーズを入れる

---
## 韻律処理
:::tip[韻律処理]
適切な "読み"（ = 音素列，H/L アクセント情報）を元に，音素・ポーズ継続長，$F_0$ パターン，パワーパターンを決定する。  
なお，HMM 音声合成方式の場合は波形生成部とまとめてできる。
:::
韻律処理の方法として，$F_0$ パターン生成過程モデルというものもある。
「観測された $F_0$ パターン = フレーズ成分（大局的変化）+ アクセント成分（局所的変化）」として捉え，声帯振動の生理的・物理的特性に基づいてモデル化する方法。
- 広い時間スケールでの韻律をモデリングできる（ HMM では難しい）。韻律は文によらず存在する場合が多いし
- HMM 合成方式でできたモデルを後処理する方法としても用いられる

---
## 波形生成
ここでは， HMM 音声合成方式について説明する。
:::tip[波形生成]
:::

### HMM 音声合成方式の流れ
前提として，入力単語 $m$  として，特徴量系列 $\bm{o} = [o_1,…,o_T]$ を出力する HMM を考える。  
この時，特徴量 $\hat{\bm{o}} = \max_{\bm{o}} P(\bm{o} |M = m) \approx \max_{\bm{o}} \left(\max_S P(\bm{o},S |M = m)\right)$ を出力とする。
- ビダビスコアのように max で近似している。$S$ は状態系列
- 特徴量は，ケプストラム係数 $\bm{c_t}$ を用いて，$\bm{o}_t=[\bm{c}_t^T, \Delta \bm{c}_t^T, \Delta^2 \bm{c}_t^T]^T$ のようにする

#### 1. 状態遷移と特徴量出力の決定
実際は，音素 HMM を連結した文 HMM を考えるため，以後は，入力単語に対応して作成された文 HMM を $m$ とする。  
$P(\bm{O},S|M = m) = P(\bm{O}|S,M = m)P(S|M = m)$ を解いて，$\bm{o}$ の確率変数である $\bm{O}$ の最尤値 $\hat{\bm{o}}$ を求めたい。

そこで，近似的に以下の二つ最大化問題を解く
- $\hat{s} = \max_S P(S|M = m)$
- $\hat{\bm{o}} = \max_{\bm{O}} P(\bm{O}|S = \hat{s},M = m)$

これにより，文 HMM に対する最尤状態系列 $\hat{s}$ を求め，
$\bm{o}_t=[\bm{c}_t^T, \Delta \bm{c}_t^T, \Delta^2 \bm{c}_t^T]^T$ の最尤ケプストラムを求めれば良いが，計算方法は難しい。

#### 2. 特徴量の設計：
最尤スペクトル包絡系列にブラスして，適切な $F_0$ パターンを持つ音声波形で駆動しなければならない。
これは，1 で $\bm{o} =  [\bm{c}_t^T, \Delta \bm{c}_t^T, \Delta^2 \bm{c}_t^T, f_t, \Delta f_t, \Delta^2 f_t]^T$ とすれば良い。
- しかし，無声区間ではそもそも $F_0$ が定義できないため，例えば，可変次元の多空間確率分布 HMM を用いて特徴量の次元を変化させる方法もある

### 音響モデルのコンテキスト依存性
特定話者の音声を作成すれば良いため，HMM のサンプル数が少なくて済むが，一方で自然性が必要。
そこで，音声認識と比較して粒度の細かいモデルとするために，音素にプラスで文脈情報に依存させることがある。
- 品詞情報，アクセント情報，ポーズの有無，文の長さ，などなど
